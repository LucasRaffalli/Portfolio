<section class="design__container">
    <div class="carousel-container" [class.loading]="isLoading">
        <div class="scroll-overlay inset-0 top-7 left-35 rounded"></div>
        <div *ngIf="!isLoading && filteredDesigns.length > 0">
            <div class="carousel-track flex flex-col gap-10 transition-transform items-end duration-300 ease-in-out will-change-transform"
                [style.transform]="'translateY(' + translateY + 'px)'">
                <div *ngFor="let design of filteredDesigns; trackBy: trackByFn; let i = index"
                    [class.active]="i === currentIndex" [class.prev]="i === currentIndex - 1"
                    [class.next]="i === currentIndex + 1" (click)="onItemClick(design, i)"
                    class="flex items-end flex-col gap-2 carousel-item">
                    <div
                        class="w-42 h-[120px] sm:w-72 sm:h-[200px] lg:w-140 lg:h-[340px] xl:w-180 xl:h-[400px] overflow-hidden relative transition-all duration-400 border-2 border-[var(--border-color1)] p-2 hover:border-white ease-in-out hover__img cursor-pointer">
                        <img class="relative z-9 w-full h-full object-cover object-center transition-all duration-300 ease-in-out"
                            [src]="design.images[0].url" [alt]="design.images[0].alt" loading="lazy"
                            (load)="onImageLoad()">

                        <div *ngIf="design.images.length > 1" class="indicator__multiple stars mt-2"
                            [class.starred]="design.stars">
                            <span class="mt-4">
                                {{ design.images.length }}
                            </span>
                            <img class="w-8 h-8 mix-blend-inverse" src="images/multiple_indicator.png" alt="">
                        </div>
                    </div>
                    <div class="flex flex-col sm:flex-row justify-between w-full items-end">
                        <h3 class="text-sm sm:text-base md:text-lg text-end">{{ design.title }}</h3>
                        <p class="hidden sm:block text-sm sm:text-base md:text-lg">{{ design.year }}</p>
                        <a *ngIf="design.platform" href="http://{{ design.url }}" target="_blank"
                            rel="noopener noreferrer" (click)="$event.stopPropagation()">
                            <span class="hover__underline__right flex text-sm sm:text-base md:text-lg">
                                {{design.platform }}
                                <i-lucide [name]="ArrowUpRight" [size]="16" [strokeWidth]="3"></i-lucide>
                            </span>
                        </a>
                    </div>
                </div>
            </div>

            <div
                class="absolute hidden md:flex transform -left-[42vw] bottom-[50px] scale-[0.55] sm:scale-[0.80] sm:bottom-0 sm:-left-[20vw] lg:-left-[10vw] sm:-translate-y-1/2 sm:top-1/2 flex flex-col sm:flex-row gap-6 items-center">
                <div class="flex justify-center">
                    <div class="flex justify-center sm:flex-col">
                        <button class="hover__underline__top p-2 sm:p-5" (click)="previousItem()"
                            [disabled]="currentIndex === 0" title="Précédent (↑)">
                            <i-lucide [name]="MoveUp" [size]="24" [strokeWidth]="3"></i-lucide>
                        </button>
                        <button class="hover__underline p-2 sm:p-5" (click)="nextItem()"
                            [disabled]="currentIndex === filteredDesigns.length - 1" title="Suivant (↓)">
                            <i-lucide [name]="MoveDown" [size]="24" [strokeWidth]="3"></i-lucide>
                        </button>
                    </div>
                    <div class="flex flex-wrap gap-4 sm:flex-col justify-center">
                        <button *ngFor="let design of filteredDesigns; let i = index"
                            class="indicator w-2 h-2 border-0 rounded transition-all duration-300 linear cursor-pointer p-1"
                            [class.active]="i === currentIndex" (click)="goToItem(i)" [title]="design.title">
                        </button>
                    </div>
                </div>
                <div class="flex flex-col gap-5">
                    <button class="cursor-pointer" [class.active]="starsFilter === true" (click)="setStarsFilter(true)">
                        <i-lucide [name]="Star" [size]="24" [strokeWidth]="3"></i-lucide>
                    </button>
                    <button class="cursor-pointer" [class.active]="starsFilter === null" (click)="setStarsFilter(null)">
                        <i-lucide [name]="StarOff" [size]="24" [strokeWidth]="3"></i-lucide>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="isModalOpen" [class.open]="isModalOpen"
        class="fixed inset-0 z-500 flex items-center justify-center bg-[var(--background-color)]"
        (click)="closeModal()">

        <div class="relative w-full flex flex-col justify-between lg:flex-row gap-4 h-screen p-2 lg:p-10"
            *ngIf="selectedDesign" (click)="$event.stopPropagation()">

            <div class="relative flex-1 flex flex-col modal-main-image z-10 min-h-0">
                <div class="flex-1 flex items-center justify-center p-4 min-h-0">
                    <div class="relative flex justify-center items-center w-full h-full max-w-full max-h-full">
                        <img [src]="selectedDesign.images[currentImageIndex].url"
                            [alt]="selectedDesign.images[currentImageIndex].alt"
                            class="max-w-full max-h-full w-auto h-auto object-contain shadow-2xl"
                            style="max-height: 100%; max-width: 100%;">
                    </div>
                </div>
            </div>
            <section class="informations flex flex-col justify-between gap-4 p-2 max-w-[360px]">
                <div class="flex justify-end">
                    <button class="relative p-2 cursor-pointer btn__hover__close" (click)="closeModal()"
                        title="Fermer (Esc)">
                        <i-lucide [name]="X" [size]="20" [strokeWidth]="2" class="text-[var(--text-color)] "></i-lucide>
                    </button>
                </div>
                <div class="w-full p-6 overflow-y-auto border border-[var(--border-color1)] h-full w-full">
                    <div class="space-y-2">
                        <h2 class="text-2xl lg:text-3xl font-light">{{ selectedDesign.title }}</h2>
                        <p class="text-lg text-[var(--small-dark2)]">{{ selectedDesign.year }}</p>
                    </div>

                    <div *ngIf="selectedDesign.platform" class="space-y-2">
                        <h3 class="text-sm font-medium text-[var(--text-color)] uppercase tracking-wider mt-8">
                            Plateforme
                        </h3>
                        <a href="http://{{ selectedDesign.url }}" target="_blank" rel="noopener noreferrer"
                            class="flex hover__underline__invert">
                            {{ selectedDesign.platform }}
                            <i-lucide [name]="ArrowUpRight" [size]="16" [strokeWidth]="3"></i-lucide>
                        </a>
                    </div>

                    <div *ngIf="selectedDesign.description" class="space-y-2">
                        <h3 class="text-sm font-medium text-[var(--text-color)] uppercase tracking-wider mt-8">
                            Description
                        </h3>
                        <p class="text-base text-[var(--small-dark2)] leading-relaxed">{{ selectedDesign.description
                            }}
                        </p>
                    </div>

                    <div *ngIf="selectedDesign.tags" class="space-y-2">
                        <h3 class="text-sm font-medium text-[var(--text-color)] uppercase tracking-wider mt-8">Tags</h3>
                        <div class="flex flex-wrap gap-2">
                            <span *ngFor="let tag of selectedDesign.tags"
                                class="px-4 py-2 text-sm bg-[var(--background-color)] border border-[var(--border-color1)]">
                                {{ tag }}
                            </span>
                        </div>
                    </div>
                </div>
                <div *ngIf="selectedDesign.images && selectedDesign.images.length > 1"
                    class="p-6 flex flex-col justify-between border border-[var(--border-color1)] max-h-48">

                    <div class="flex-1 overflow-y-auto">
                        <div class="flex flex-wrap gap-2 pb-2">
                            <div *ngFor="let image of selectedDesign.images; let i = index"
                                class="flex-shrink-0 w-16 h-16 overflow-hidden border-1 cursor-pointer transition-all duration-200"
                                [class.border-white]="i === currentImageIndex"
                                [class.border-[var(--border-color1)]]="i !== currentImageIndex"
                                [class.opacity-60]="i !== currentImageIndex" [class.p-0]="i !== currentImageIndex"
                                [class.p-2]="i === currentImageIndex" (click)="selectImage(i)">
                                <img [src]="image.url" [alt]="image.alt"
                                    class="w-full h-full object-cover hover:scale-105 transition-transform rounded">
                            </div>
                        </div>
                    </div>

                    <div class="text-xs text-[var(--small-dark2)] mt-2 text-center">
                        {{ currentImageIndex + 1 }} / {{ selectedDesign.images.length }}
                    </div>
                </div>
            </section>
        </div>
    </div>
</section>